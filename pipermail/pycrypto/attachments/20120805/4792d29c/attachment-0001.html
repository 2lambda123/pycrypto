<tt>
Hi&nbsp;Yaron,&lt;br&gt;&lt;br&gt;Some&nbsp;comments&nbsp;inline:&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
 *&nbsp;The&nbsp;documentation&nbsp;of&nbsp;&quot;generate&quot;&nbsp;says&nbsp;that&nbsp;randfunc&nbsp;returns&nbsp;X&nbsp;random&lt;br&gt;<br>
 &nbsp; bytes.&nbsp;I&nbsp;think&nbsp;this&nbsp;should&nbsp;be&nbsp;bits.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I&nbsp;am&nbsp;not&nbsp;100%&nbsp;sure,&nbsp;but&nbsp;&lt;span&nbsp;class=&quot;k&quot;&gt;a&nbsp;common&nbsp;idiom&nbsp;in&nbsp;pycrypto&nbsp;is:&lt;br&gt;&lt;br&gt;&quot;&lt;br&gt;if&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;n&quot;&gt;randfunc&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;ow&quot;&gt;is&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span&nbsp;class=&quot;p&quot;&gt;:&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;n&quot;&gt;    &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;p&quot;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;n&quot;&gt;randfunc&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;o&quot;&gt;=&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span&nbsp;class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span&nbsp;class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span&nbsp;class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span&nbsp;class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span&nbsp;class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;br&gt;<br>
&quot;&lt;br&gt;&lt;br&gt;so&nbsp;randfunc(N)&nbsp;returns&nbsp;N&nbsp;bytes&nbsp;of&nbsp;full&nbsp;entropy.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
 *&nbsp;The&nbsp;&quot;generate&quot;&nbsp;function&nbsp;is&nbsp;way&nbsp;too&nbsp;conservative.&nbsp;We&nbsp;construct&nbsp;p&nbsp;as&lt;br&gt;<br>
 &nbsp; 2*q+1,&nbsp;where&nbsp;both&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;prime.&nbsp;This&nbsp;makes&nbsp;p&nbsp;a&nbsp;classic&nbsp;&quot;safe&lt;br&gt;<br>
 &nbsp; prime&quot;.&nbsp;It&nbsp;also&nbsp;makes&nbsp;two&nbsp;of&nbsp;the&nbsp;checks&nbsp;redundant:&nbsp;g&nbsp;cannot&nbsp;divide&lt;br&gt;<br>
 &nbsp; p-1,&nbsp;because&nbsp;only&nbsp;2&nbsp;and&nbsp;q&nbsp;divide&nbsp;it.&nbsp;g&nbsp;cannot&nbsp;be&nbsp;2,&nbsp;and&nbsp;most&nbsp;likely&lt;br&gt;<br>
 &nbsp; will&nbsp;not&nbsp;be&nbsp;q&nbsp;during&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;universe.&nbsp;I&nbsp;believe&nbsp;that&lt;br&gt;<br>
 &nbsp; similarly,&nbsp;g**-1&nbsp;cannot&nbsp;divide&nbsp;p-1,&nbsp;but&nbsp;my&nbsp;algebra&nbsp;skills&nbsp;are&nbsp;too&lt;br&gt;<br>
 &nbsp; rusty&nbsp;to&nbsp;prove&nbsp;it.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I&nbsp;contributed&nbsp;to&nbsp;that&nbsp;part&nbsp;with&nbsp;a&nbsp;patch.&nbsp;My&nbsp;intention&nbsp;was&nbsp;actually&nbsp;to&nbsp;list&nbsp;in&nbsp;the&nbsp;loop&lt;br&gt;as&nbsp;many&nbsp;criteria&nbsp;as&nbsp;possible&nbsp;that&nbsp;a&nbsp;generator&nbsp;safe&nbsp;for&nbsp;both&nbsp;Elgamal&nbsp;encryption&nbsp;and&nbsp;Elgamal&nbsp;signatures&nbsp;(because&nbsp;.generate()&nbsp;does&nbsp;not&nbsp;know&nbsp;how&nbsp;the&nbsp;key&nbsp;will&nbsp;be&nbsp;used)&nbsp;must&nbsp;fulfill.&lt;br&gt;<br>
&lt;br&gt;It&#39;s&nbsp;true&nbsp;they&nbsp;are&nbsp;redundant&nbsp;in&nbsp;practice,&nbsp;but&nbsp;I&nbsp;think&nbsp;it&#39;s&nbsp;good&nbsp;to&nbsp;leave&nbsp;a&nbsp;track&nbsp;behind&nbsp;with&nbsp;the&nbsp;general&nbsp;conditions&nbsp;that&nbsp;one&nbsp;must&nbsp;check,&nbsp;regardless&nbsp;of&nbsp;how&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;are&nbsp;computed.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
 *&nbsp;For&nbsp;the&nbsp;same&nbsp;reasons,&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;for&nbsp;the&nbsp;loop&nbsp;when&lt;br&gt;<br>
 &nbsp; constructing&nbsp;K&nbsp;(the&nbsp;secret&nbsp;parameter),&nbsp;e.g.&nbsp;on&nbsp;line&nbsp;#342.&nbsp;You&nbsp;just&lt;br&gt;<br>
 &nbsp; need&nbsp;to&nbsp;ensure&nbsp;that&nbsp;it&nbsp;is&nbsp;an&nbsp;odd&nbsp;number,&nbsp;otherwise&nbsp;its&nbsp;GCD&nbsp;with&nbsp;p-1&lt;br&gt;<br>
 &nbsp; would&nbsp;be&nbsp;2.&nbsp;So&nbsp;choose&nbsp;a&nbsp;random&nbsp;t,&nbsp;2&nbsp;&lt;&nbsp;t&nbsp;&lt;&nbsp;q-1,&nbsp;and&nbsp;let&nbsp;K=2*t+1.&nbsp;No&lt;br&gt;<br>
 &nbsp; need&nbsp;for&nbsp;a&nbsp;loop&nbsp;or&nbsp;for&nbsp;the&nbsp;GCD&nbsp;calculation.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;In&nbsp;the&nbsp;_sign()&nbsp;method&nbsp;I&nbsp;see&nbsp;only&nbsp;a&nbsp;loop&nbsp;to&nbsp;ensure&nbsp;that&nbsp;residues&nbsp;remains&nbsp;in&nbsp;the&nbsp;range&nbsp;0..p-1.&nbsp;The&nbsp;loop&nbsp;does&nbsp;not&nbsp;contribute&nbsp;to&nbsp;GDC&nbsp;computation.&lt;br&gt; &lt;/div&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
 *&nbsp;An&nbsp;important&nbsp;check&nbsp;is&nbsp;missing:&nbsp;the&nbsp;message&nbsp;M&nbsp;needs&nbsp;to&nbsp;be&nbsp;less&nbsp;than&lt;br&gt;<br>
 &nbsp; p,&nbsp;both&nbsp;when&nbsp;signing&nbsp;and&nbsp;certainly&nbsp;when&nbsp;encrypting&nbsp;it.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;True.&nbsp;Note&nbsp;that&nbsp;M&nbsp;must&nbsp;not&nbsp;the&nbsp;message&nbsp;when&nbsp;signing&nbsp;with&nbsp;PyCrypto&#39;s&nbsp;Elgamal.&nbsp;It&nbsp;must&nbsp;be&nbsp;really&nbsp;be&nbsp;the&nbsp;cryptographic&nbsp;hash&nbsp;of&nbsp;the&nbsp;message.&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>

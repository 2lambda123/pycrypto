<tt>
Hi:&lt;br&gt;In&nbsp;this&nbsp;new&nbsp;demo&nbsp;&lt;br&gt;i&nbsp;use&nbsp;randint()&nbsp;and &nbsp;Random.new().read()&nbsp;from&nbsp;the&nbsp;new&nbsp;Crypto.random&nbsp;module.&lt;br&gt;DSA&nbsp;use&nbsp;now&nbsp;512&nbsp;bit&nbsp;key&nbsp;at&nbsp;least.&lt;br&gt;and&nbsp;i&nbsp;use &nbsp;sha512&nbsp;for&nbsp;DSA.&lt;br&gt;DSA&nbsp;only&nbsp;verifty&nbsp;the&nbsp;sha512&nbsp;hash&nbsp;of&nbsp;the&nbsp;original&nbsp;AES&nbsp;password.&lt;br&gt;<br>
&lt;br&gt;about&nbsp;rsa:&lt;br&gt;&lt;span&nbsp;class=&quot;gI&quot;&gt;&lt;span&nbsp;class=&quot;ik&quot;&gt;&lt;img&nbsp;class=&quot;&nbsp;QrVm3d&quot;&nbsp;id=&quot;upi&quot;&nbsp;name=&quot;upi&quot;&nbsp;src=&quot;images/cleardot.gif&quot;&nbsp;height=&quot;16px&quot;&nbsp;width=&quot;16px&quot;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;gD&quot;&nbsp;style=&quot;color:&nbsp;rgb(121,&nbsp;6,&nbsp;25);&quot;&gt;Dwayne&nbsp;C.&nbsp;Litzenberger&nbsp;said&nbsp;something&nbsp;about&nbsp;OAEP&lt;/span&gt;&lt;/span&gt;&nbsp;for&nbsp;RSA.&lt;br&gt;<br>
   &nbsp;this&nbsp;is&nbsp;a&nbsp;very&nbsp;critical&nbsp;issue,&nbsp;how&nbsp;can&nbsp;I&nbsp;use&nbsp;it.&lt;br&gt;&lt;br&gt;Well,&nbsp;I&nbsp;feel&nbsp;now&nbsp;like&nbsp;child&nbsp;in&nbsp;a&nbsp;mine&nbsp;field.&nbsp;&lt;br&gt;So&nbsp;please&nbsp;help&nbsp;me&nbsp;check&nbsp;this&nbsp;again.&lt;br&gt;&lt;br&gt;&lt;br&gt;Thank&nbsp;you&lt;br&gt;-----------------------------------------------------------------------------------&lt;br&gt;<br>
#!/usr/bin/env&nbsp;python&lt;br&gt;from&nbsp;Crypto.Cipher&nbsp;import&nbsp;AES&lt;br&gt;from&nbsp;Crypto.Util.number&nbsp;import&nbsp;GCD&lt;br&gt;from&nbsp;Crypto&nbsp;import&nbsp;Random&lt;br&gt;import&nbsp;os,sys&lt;br&gt;#####################AES&nbsp;####################&lt;br&gt;print&nbsp;&amp;quot;=====AES&nbsp;256&nbsp;Demo=====&amp;quot;&lt;br&gt;<br>
#&nbsp;use&nbsp;AES&nbsp;to&nbsp;encrypt&nbsp;the&nbsp;real&nbsp;message&lt;br&gt;#&nbsp;use&nbsp;the&nbsp;more&nbsp;secure&nbsp;Crypto.Random&nbsp;to&nbsp;generate&nbsp;PWD&nbsp;and&nbsp;Initialbyte/IV&lt;br&gt;#&nbsp;AES&nbsp;key&nbsp;is&nbsp;32&nbsp;byte&nbsp;or&nbsp;16*hex_digit&lt;br&gt;#&nbsp;Initial16bytes:16&nbsp;bytes&nbsp;or&nbsp;8*hex_digit&lt;br&gt;PWD=&amp;quot;&amp;quot;&lt;br&gt;rpool&nbsp;=&nbsp;Random.new()&nbsp;&lt;br&gt;<br>
Random.atfork()&nbsp;&lt;br&gt;&lt;br&gt;PWD&nbsp;=&nbsp;rpool.read(16).encode(&amp;quot;hex&amp;quot;)&lt;br&gt;Initial16bytes=rpool.read(8).encode(&amp;quot;hex&amp;quot;)&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;AES-key:&amp;quot;,PWD,&amp;quot;len:&amp;quot;,len(PWD)&lt;br&gt;print&nbsp;&amp;quot;Initial16bytes:&amp;quot;,Initial16bytes&lt;br&gt;<br>
crypt&nbsp;=&nbsp;AES.new(PWD,AES.MODE_CBC,Initial16bytes)&lt;br&gt;&lt;br&gt;plain=&amp;quot;sex&nbsp;drugs&nbsp;and&nbsp;crypto&amp;quot;&lt;br&gt;#block&nbsp;ciffre&nbsp;need&nbsp;string&nbsp;with&nbsp;lenth&nbsp;16:&nbsp;add&nbsp;the&nbsp;restbyte&nbsp;to&nbsp;plain&lt;br&gt;restbyte&nbsp;=(16-len(plain)%16)%16&lt;br&gt;temp_string=&amp;quot;&amp;quot;&lt;br&gt;<br>
for&nbsp;a&nbsp;in&nbsp;range(restbyte):&lt;br&gt;   &nbsp;temp_string+=&amp;quot;&nbsp;&amp;quot;&lt;br&gt;plain+=temp_string&lt;br&gt;#encryption&lt;br&gt;print&nbsp;&amp;quot;\nplain&nbsp;text:&nbsp;\n&amp;quot;,plain,&amp;quot;\n&amp;quot;&lt;br&gt;crypt_txt=&nbsp;crypt.encrypt(plain)&lt;br&gt;print&nbsp;&amp;quot;encrypted&nbsp;text:&nbsp;\n&amp;quot;,crypt_txt.encode(&amp;quot;hex&amp;quot;),&amp;quot;\n&amp;quot;&lt;br&gt;<br>
#decryption&lt;br&gt;crypt&nbsp;=&nbsp;AES.new(PWD,AES.MODE_CBC,Initial16bytes)&lt;br&gt;print&nbsp;&amp;quot;decrypted&nbsp;text:&nbsp;\n&amp;quot;,&nbsp;crypt.decrypt(crypt_txt)&lt;br&gt;####################&nbsp;RSA&nbsp;####################&lt;br&gt;print&nbsp;&amp;quot;\n=====RSA&nbsp;368&nbsp;Demo=====&amp;quot;&lt;br&gt;<br>
#use&nbsp;1&nbsp;RSA&nbsp;key&nbsp;to&nbsp;encrypt&nbsp;the&nbsp;AES&nbsp;key&lt;br&gt;#use&nbsp;another&nbsp;RSA&nbsp;key&nbsp;to&nbsp;sign&nbsp;AES&nbsp;key&lt;br&gt;from&nbsp;Crypto.PublicKey&nbsp;import&nbsp;RSA&lt;br&gt;&lt;br&gt;#start&nbsp;the&nbsp;random&nbsp;generator&lt;br&gt;rpool&nbsp;=&nbsp;Random.new()&nbsp;&lt;br&gt;Random.atfork()&lt;br&gt;&lt;br&gt;#&nbsp;generate&nbsp;both&nbsp;RSA&nbsp;keys, &nbsp;&lt;br&gt;<br>
privatekeyCMS&nbsp;=&nbsp;RSA.generate(368,&nbsp;rpool.read)&lt;br&gt;Random.atfork()&lt;br&gt;privatekeyClient&nbsp;=&nbsp;RSA.generate(368,&nbsp;rpool.read)&lt;br&gt;publickeyCMS&nbsp;=&nbsp;privatekeyCMS.publickey()&lt;br&gt;publickeyClient&nbsp;=&nbsp;privatekeyClient.publickey()&lt;br&gt;&lt;br&gt;#sign&nbsp;the&nbsp;AES&nbsp;PWD&nbsp;with&nbsp;server&nbsp;private&nbsp;key&lt;br&gt;<br>
signed_PWD&nbsp;=&nbsp;privatekeyCMS.sign(PWD,&amp;quot;&amp;quot;)&lt;br&gt;#encrypt&nbsp;AES&nbsp;PWD&nbsp;with&nbsp;client&nbsp;public&nbsp;key&lt;br&gt;enc_PWD&nbsp;=&nbsp;publickeyClient.encrypt(PWD,&nbsp;&amp;quot;&amp;quot;)&lt;br&gt;print&nbsp;&amp;quot;with&nbsp;publickeyClient&nbsp;encrypted&nbsp;AES-PWD:&amp;quot;&lt;br&gt;print&nbsp;enc_PWD[0].encode(&amp;quot;hex&amp;quot;),&amp;quot;\n&amp;quot;&lt;br&gt;<br>
print&nbsp;&amp;quot;with&nbsp;privatekeyCMS&nbsp;signed&nbsp;AES-PWD:&amp;quot;&lt;br&gt;print&nbsp;signed_PWD[0],&amp;quot;\n&amp;quot;&lt;br&gt;&lt;br&gt;#decryption&lt;br&gt;dec_PWD=&nbsp;privatekeyClient.decrypt(enc_PWD[0])&lt;br&gt;#verify&nbsp;identity&nbsp;of&nbsp;the&nbsp;&lt;br&gt;print&nbsp;&amp;quot;key&nbsp;verify:\n&amp;quot;,publickeyCMS.verify(dec_PWD,signed_PWD)&lt;br&gt;<br>
print&nbsp;&amp;quot;decrypted&nbsp;PWD:\n&amp;quot;,dec_PWD&lt;br&gt;&lt;br&gt;&lt;br&gt;####################&nbsp;ELGAMAL&nbsp;####################&lt;br&gt;from&nbsp;Crypto.PublicKey&nbsp;import&nbsp;ElGamal&lt;br&gt;print&nbsp;&amp;quot;\n=====ELGamal&nbsp;368&nbsp;Demo=====&amp;quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;#generate&nbsp;2&nbsp;ELGAMAL&nbsp;key&nbsp;pair&lt;br&gt;<br>
rpool&nbsp;=&nbsp;Random.new()&nbsp;&lt;br&gt;Random.atfork()&lt;br&gt;privatekeyCMS&nbsp;=&nbsp;ElGamal.generate(368,&nbsp;rpool.read)&lt;br&gt;privatekeyClient&nbsp;=&nbsp;ElGamal.generate(368,&nbsp;rpool.read)&lt;br&gt;publickeyCMS&nbsp;=&nbsp;privatekeyCMS.publickey()&lt;br&gt;publickeyClient&nbsp;=&nbsp;privatekeyClient.publickey()&lt;br&gt;<br>
&lt;br&gt;#generate&nbsp;for&nbsp;each&nbsp;encryption&nbsp;session&nbsp;new&nbsp;K&lt;br&gt;K=rpool.read(16).encode(&amp;quot;hex&amp;quot;)&lt;br&gt;print&nbsp;&amp;quot;K&nbsp;for&nbsp;encrypt:&amp;quot;,K&lt;br&gt;#encryption&lt;br&gt;enc_PWD&nbsp;=&nbsp;publickeyClient.encrypt(PWD,&nbsp;K)&lt;br&gt;&lt;br&gt;#generate&nbsp;for&nbsp;each&nbsp;sign&nbsp;session&nbsp;new&nbsp;k&lt;br&gt;<br>
strong_random&nbsp;=&nbsp;Random.random.StrongRandom(randfunc=rpool.read)&lt;br&gt;k&nbsp;=&nbsp;strong_random.randint(2,privatekeyCMS.p-2)&lt;br&gt;temp_p=privatekeyCMS.p&lt;br&gt;while&nbsp;GCD(privatekeyCMS.p-1,k)&amp;gt;1:&lt;br&gt;   &nbsp;k&nbsp;=&nbsp;strong_random.randint(3,temp_p-2)&lt;br&gt;<br>
print&nbsp;&amp;quot;k&nbsp;for&nbsp;sign:&amp;quot;,k,&amp;quot;\n&amp;quot;&lt;br&gt;#signature&lt;br&gt;signed_PWD&nbsp;=&nbsp;privatekeyCMS.sign(PWD,k)&lt;br&gt;&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;with&nbsp;publickeyClient&nbsp;encrypted&nbsp;AES-PWD:&amp;quot;&lt;br&gt;print&nbsp;enc_PWD[0].encode(&amp;quot;hex&amp;quot;)&lt;br&gt;print&nbsp;&amp;quot;with&nbsp;privatekeyCMS&nbsp;signed&nbsp;AES-PWD:&amp;quot;&lt;br&gt;<br>
print&nbsp;signed_PWD[0],&amp;quot;\n&amp;quot;&lt;br&gt;&lt;br&gt;#decryption&lt;br&gt;&lt;br&gt;dec_PWD=&nbsp;privatekeyClient.decrypt(enc_PWD)&lt;br&gt;#verify&nbsp;signature&lt;br&gt;print&nbsp;&amp;quot;verify&nbsp;key:\n&amp;quot;,bool(publickeyCMS.verify(dec_PWD,signed_PWD))&lt;br&gt;print&nbsp;&amp;quot;decrypted&nbsp;PWD:\n&amp;quot;,dec_PWD&lt;br&gt;<br>
&lt;br&gt;####################&nbsp;DSA&nbsp;only&nbsp;sign&nbsp;####################&lt;br&gt;&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;\n=====DSA&nbsp;512&nbsp;Demo=====&amp;quot;&lt;br&gt;from&nbsp;Crypto.PublicKey&nbsp;import&nbsp;DSA&lt;br&gt;#start&nbsp;the&nbsp;randomgenerator&nbsp;to&nbsp;generate&nbsp;integer&nbsp;&lt;br&gt;rpool&nbsp;=&nbsp;Random.new()&lt;br&gt;<br>
strong_random&nbsp;=&nbsp;Random.random.StrongRandom(randfunc=rpool.read)&lt;br&gt;Random.atfork()&nbsp;&lt;br&gt;&lt;br&gt;#generate&nbsp;Server&nbsp;DSA&nbsp;key&lt;br&gt;privatekeyCMS&nbsp;=&nbsp;DSA.generate(512,&nbsp;rpool.read)&lt;br&gt;publickeyCMS&nbsp;=&nbsp;privatekeyCMS.publickey()&lt;br&gt;&lt;br&gt;#&nbsp;generatae&nbsp;sha&nbsp;hash,&nbsp;which&nbsp;will&nbsp;be&nbsp;signed&nbsp;by&nbsp;the&nbsp;private&nbsp;key&lt;br&gt;<br>
import&nbsp;hashlib&lt;br&gt;m&nbsp;=&nbsp;hashlib.sha512()&lt;br&gt;m.update(PWD)&lt;br&gt;print&nbsp;&amp;quot;sha512&nbsp;hash&amp;quot;,m.digest()&lt;br&gt;&lt;br&gt;#generate&nbsp;for&nbsp;each&nbsp;sign&nbsp;session&nbsp;new&nbsp;k&nbsp;&lt;br&gt;k&nbsp;=&nbsp;strong_random.randint(3,privatekeyCMS.q-1)&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;k&nbsp;for&nbsp;sign:&amp;quot;,k,&amp;quot;\n&amp;quot;&lt;br&gt;<br>
&lt;br&gt;#sign&lt;br&gt;signed_PWD&nbsp;=&nbsp;privatekeyCMS.sign(m.digest(),k)&lt;br&gt;&lt;br&gt;&lt;br&gt;m&nbsp;=&nbsp;hashlib.sha512()&lt;br&gt;m.update(dec_PWD)&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;sha512&nbsp;hash&amp;quot;,m.digest()&lt;br&gt;&lt;br&gt;#verify&lt;br&gt;print&nbsp;&amp;quot;verify&nbsp;key:\n&amp;quot;,publickeyCMS.verify(m.digest(),signed_PWD)&lt;br&gt;<br>
print&nbsp;&amp;quot;decrypted&nbsp;PWD&nbsp;from&nbsp;ELGAMAL:\n&amp;quot;,dec_PWD&lt;br&gt;&lt;br&gt;#decrypt&nbsp;the&nbsp;real&nbsp;message&nbsp;using&nbsp;the&nbsp;AES&nbsp;key&lt;br&gt;crypt&nbsp;=&nbsp;AES.new(dec_PWD,AES.MODE_CBC,Initial16bytes)&lt;br&gt;print&nbsp;&amp;quot;decrypted&nbsp;text:&nbsp;\n&amp;quot;,&nbsp;crypt.decrypt(crypt_txt)&lt;br&gt;<br>
print&nbsp;&amp;quot;\n=====End&nbsp;of&nbsp;Demo=====&amp;quot;&lt;br&gt;&lt;br&gt;<br>

</tt>
